<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<title>Find your person!</title>
</head>
<style>
	.recommendation_cont {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		border: 1px solid black;
		width: 600px;
		height: 800px;
		margin: auto;
	}
	.user_images {
		display: grid;
		grid-template-columns: 1fr;
		grid-template-rows: repeat(3, 1fr);
		gap: 10px;
		width: 100%;
		height: 70%;
	}
	.user_name_age_desc{
		display: flex;
		flex-direction: column;
		height: 30%;
		width: 100%;
	}
	.user_name_age {
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		height: 50px;
		width: 80%;
		padding: 5%;
		margin: 0 auto 0 auto;
	}
	.button_cont {
		display: flex;
		flex-direction: row;
		justify-content: space-around;
		height: 50px;
		width: 80%;
		margin: 0 auto 0 auto;
	}
	.user_name {
		font-size: 20px;
	}
	.user_age {
		font-size: 20px;
	}
	.user_desc_cont {
		padding: 5%;
		margin: 0 auto 0 auto;
	}
	.user_desc {
		font-size: 15px;
	}
</style>

<body>
	{% include 'navbar.html' %}   
	<div class="{% if form.errors %}alert alert-danger{% else %}alert alert-success{% endif %} page_wrapper">
		{% block messages%}
			{% if messages %}
				{% for message in messages %}
					{{ message }}
				{% endfor %}
			{% endif %}
			{% if not messages %}
				<style>
					.page_wrapper {
						display: none;
					}
				</style>
			{% endif %}
		{% endblock %}
    </div>
	<div class="recommendation_cont">
		<div class="user_images">
			<!-- User images here -->
		<div class="photo_navigation">
			<button type="button" class="btn btn-secondary" onclick="navigate_photos('prev')">Previous</button>
			<button type="button" class="btn btn-secondary" onclick="navigate_photos('next')">Next</button>
		</div>
		</div>
		<div class="user_name_age_desc">
			<div class="user_name_age">        
				<span class="user_name">
					{{ rec_user.first_name }} {{ rec_user.last_name }}
				</span>
				<span class="user_age">
					{{ rec_user.age }}
				</span>
			</div>
			<div class="user_desc_cont">
				<p class="user_desc">{{ rec_user.description }}</p>
			</div>
			<div class="button_cont">
				<button type="button" class="btn btn-success" onclick="handle_action('like', '{{rec_user.id}}')">Like</button>
				<button type="button" class="btn btn-primary" onclick="handle_action('report', '{{rec_user.id}}')">Report</button>
				<button type="button" class="btn btn-danger" onclick="handle_action('dislike', '{{rec_user.id}}')">Dislike</button>
			</div>
		</div>
	</div>
</body>
<script>
	document.addEventListener('DOMContentLoaded', function() {
		const like_button = document.querySelector('.btn-success');
		const report_button = document.querySelector('.btn-primary');
		const dislike_button = document.querySelector('.btn-danger');

	});

function getCSRFToken() {
    return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
}

function handle_action(type, user_id) {
    fetch('/handle_action/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({
            type: type,
            user_id: user_id
        })
    })
    .then(response => response.json())
    .then(result => {
        console.log(result);
        if (result.user_id) {
            // Update the user block with the new user data
            document.querySelector('.user_name').innerText = result.user_first_name + ' ' + result.user_last_name;
            document.querySelector('.user_age').innerText = result.user_age;
            document.querySelector('.user_desc').innerText = result.user_desc;
            document.querySelector('.btn-success').setAttribute('onclick', `handle_action('like', ${result.user_id})`);
            document.querySelector('.btn-primary').setAttribute('onclick', `handle_action('report', ${result.user_id})`);
            document.querySelector('.btn-danger').setAttribute('onclick', `handle_action('dislike', ${result.user_id})`);
        } else {
            alert(result.message);
        }
    });
}
</script>
</html>